<nb-card class="position-relative" [class.h-100]="isMain" [class.w-100]="isMain">
    <ngx-spinner [name]="'activity-main'" bdColor="#e5e5e5" [style.opacity]="0.8" [zIndex]="999" size="medium" color="#3de2ab" type="ball-clip-rotate-multiple" [fullScreen]="false"></ngx-spinner>
    <nb-card-header style="padding: 1rem 1rem; height: 4rem;">
        <span class="display-flex align-items-center float-left h-100 float-left">
      <nb-icon icon="calendar-plus" pack="font-awesome" class="mr-2"></nb-icon>
      <b style="font: 600 17px/16px monospace, sans-serif; color: #747678">Activity</b>
    </span>
        <button *ngIf="!isMain" class="float-right ml-1" (click)="state.show = !state.show" outline nbButton size="small">
      <nb-icon [icon]="state.show ? 'arrow-down'  : 'arrow-left' + '-outline'"></nb-icon>
    </button>
        <button class="float-right" (click)="useReload()" outline nbButton size="small">
      <nb-icon icon="sync-outline"></nb-icon>
      </button>
        <app-activity-type [type]="state.type" (typeChange)="state.type = $event; state.show = true"></app-activity-type>
        <app-activity-export [data]="state.array"></app-activity-export>
        <app-activity-add [canAdd]="state.canAdd" [isMain]="isMain" [for]="for" [deal]="deal" [campaign]="campaign"></app-activity-add>
    </nb-card-header>
    <nb-card-body class="p-0" *ngIf="isMain || state.show">
        <div class="query">
            <app-activity-query [isMain]="isMain" [search]="search" (useSearch)="useSearch($event)"></app-activity-query>
        </div>
        <div class="main">
            <div class="content" *ngIf="state.filterArray.length > 0">
                <app-activity-datatable (useCheck)="useCheck($event)" [for]="for" [deal]="deal" [campaign]="campaign" [isMain]="isMain" *ngIf="state.type === 'datatable'" [state]="state" [sort]="sort" (useSortState)="state.sortBy = $event; useSort()"></app-activity-datatable>
                <app-activity-card (useCheck)="useCheck($event)" [for]="for" [deal]="deal" [campaign]="campaign" [isMain]="isMain" *ngIf="state.type === 'card'" [state]="state" [sort]="sort" (useSortState)="state.sortBy = $event; useSort()"></app-activity-card>
                <div *ngIf="state.type === 'calendar'" class="w-100 mb-2 display-flex" style="max-width: 100%; overflow-x: auto">
                    <div class="float-left" style="display: inline-block; min-width: 10rem;">
                        <nb-form-field class="w-100">
                            <nb-select size="small" [style.height]="'3rem'" fullWidth placeholder="Select Type" [(ngModel)]="subType">
                                <nb-option value="month">Month</nb-option>
                                <nb-option value="week">Week</nb-option>
                                <nb-option value="day">Day</nb-option>
                            </nb-select>
                        </nb-form-field>
                    </div>
                    <div class="float-left" style="display: inline-block; min-width: 10rem;">
                        <nb-form-field class="w-100">
                            <nb-icon icon="calendar-outline" nbSuffix></nb-icon>
                            <input class="border-radius-0" fullWidth readonly size="small" [nbDatepicker]="datePicker" [style.height]="'3rem'" nbInput [value]="viewDate | date: 'dd/MM/yyyy'">
                            <nb-datepicker (dateChange)="viewDate = $event;" [format]="'dd/MM/yyyy'" #datePicker></nb-datepicker>
                        </nb-form-field>
                    </div>
                    <div class="float-left" style="display: inline-block; min-width: 3rem;">
                        <button nbButton status="primary" class="border-radius-0 w-100" [style.height]="'3rem'" size="small" mwlCalendarPreviousView [view]="subType" [(viewDate)]="viewDate">
                        <nb-icon icon="arrow-ios-back-outline"></nb-icon>
                        </button>
                    </div>
                    <div class="float-left" style="display: inline-block; min-width: 5rem;">
                        <button nbButton status="default" class="w-100 border-radius-0" [style.height]="'3rem'" size="small" mwlCalendarToday [(viewDate)]="viewDate">
                        Today
                    </button>
                    </div>
                    <div class="float-left" style="display: inline-block; min-width: 3rem;">
                        <button nbButton status="primary" class="w-100 border-radius-0" [style.height]="'3rem'" [style.width]="'3rem'" size="small" mwlCalendarNextView [view]="subType" [(viewDate)]="viewDate">
                        <nb-icon icon="arrow-ios-forward-outline"></nb-icon>
                      </button>
                    </div>
                </div>
                <app-activity-calendar [for]="for" [deal]="deal" [campaign]="campaign" [isMain]="isMain" [subType]="subType" [viewDate]="viewDate" *ngIf="state.type === 'calendar'" [state]="state" [sort]="sort"></app-activity-calendar>
            </div>
            <app-activity-page-count *ngIf="state.filterArray.length > 0 && state.type !== 'calendar' && checkList.length === 0" [state]="state" (useSelectPageCount)="state.pageCount = $event;useFilter()"></app-activity-page-count>
            <app-activity-solve-check *ngIf="state.filterArray.length > 0 && state.type !== 'calendar' && checkList.length > 0" [checkList]="checkList"></app-activity-solve-check>
            <div class="empty" [class.un-main]="!isMain" *ngIf="state.filterArray.length === 0 && state.type !== 'calendar'">
                <img src="assets/empty.png" />
            </div>
        </div>
    </nb-card-body>
    <nb-card-footer *ngIf="(isMain || state.show) && state.type !== 'calendar'">
        <app-activity-pagination (useChange)="usePagination()" [max]="state.max" [active]="state.active"></app-activity-pagination>
    </nb-card-footer>
</nb-card>